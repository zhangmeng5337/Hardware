调试日记：

第一阶段：
    20090508
    USB  mass storage USB通讯部分测试通过，NAND格式化不成功的原因在于NAND FLASH在写的过程中没有块擦除处理，因此造成数据在写的过程中失败

    现在主程序中将SD读写和NAND的读写做了对比，写同样的数据写一页，再读出来校验，SD测试成功，NAND测试失败。若NAND在每写一页前对该块进行擦除，也能读写校验成功。

    目前要做的工作就是把NAND的写数据程序完善，使它能像SD卡的Write程序在被外部调用时能对任意的页操作，而不需要额外增加擦除处理。还有NAND的坏块处理也要完善。



第二阶段：
    20090514
1、移植了网友圈圈的NAND FLASH读写程序，对圈圈的读写扇区函数做了修改，目前已经能够通过PC端写数据至FLASH，但FLASH写速度较慢，在USB BUS Hound
的监测中总是发现USB在等待并检测磁盘是否准备好。


   20090514
2、经调试后发现，原来是NAND擦写管理函数有问题，USB在连续写数据的时候，每写一页都有写回操作（将复制出来的数据写回），而在实际的操作中应该是
待USB一次传送的所有数据写完后才开始数据写回操作。
   后来参照圈圈的程序，在写FLASH时还传递了一个参数，那就是USB每次传送的数据长度，圈圈是根据判断剩余的扇区长度，如果等于0，则表示USB要写的数据
全部写完了，这时候就可以写回了。不用每写一个扇区就写回。
   经过测试，FLASH写的速度为200K/S，读的速度为547K/S。 目前该程序还需对速度做出改进。



